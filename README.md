# Fundshare

App for sharing expenses to see current balance between people.

# Build and host with Docker

1) Run application with a database:

1. Copy `Config.yaml_prod` to `Config.yaml`
2. you may want to change ports in `docker-compose.yml`
3. `docker-compose build`
4. `docker-compose up -d`
5. it's up to you how you open it in a browser, some firewall settings may be needed (`ufw allow 8080/tcp` on Ubuntu)

OR

2) Run only application (it will use local database):

1. Copy `Config.yaml_prod` to `Config.yaml`
2. Set `DB.host = 'host.docker.internal'` inside `Config.yaml`
3. `docker build -t fundshare-app`
4. `docker run -it -p 127.0.0.1:8080:5000 fundshare-app`
5. http://127.0.0.1:8080 should be available then.


## Database

### Import

To run .sql file on database docker:

`cat dump.sql | docker exec -i fundshare_db_1 psql -U postgres -d fundshare_prod`


### Create backup

`docker exec -t -u postgres fundshare_db_1 pg_dump fundshare_prod -c > /fundshare_backup_dump_`date +%d-%m-%Y"_"%H_%M_%S`.sql


# Development

## Frontend

We need:

* nodejs, npm
* [dotnet-script](https://github.com/filipw/dotnet-script)


Installation:

```
npm i -g npx`
npm i -g @dillonkearns/elm-graphql
dotnet tool install -g dotnet-script
```

* Build and watch for changes to rebuild:

    `dotnet script build.csx build watch`

* Generate Elm code for GraphQL API based on `graphql_schema.json` file generated by backend:

    `dotnet script build.csx api`

* Of course you can call them all:

    `dotnet script build.csx api build watch`


## Backend

We need: [.NET Core 2.1](https://www.microsoft.com/net/download) (either Runtime or SDK)

* To build and publish an executable:

    `cd FundshareBackend && dotnet publish`

